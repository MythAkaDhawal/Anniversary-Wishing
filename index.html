<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <meta name="theme-color" content="#071026" />
  <title>Happy Anniversary ‚Äî For Mumma & Papa</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <div class="stage" role="application" aria-label="Anniversary greeting for parents">
    <canvas id="confetti" aria-hidden="true"></canvas>

    <div class="left" aria-hidden="false">
      <div style="display:flex;align-items:center;gap:12px">
        <div class="heart" aria-hidden="true">‚ù§</div>
        <div>
          <h1>Happy Anniversary</h1>
          <div class="subtitle">To the most loving parents ‚Äî with all my heart</div>
        </div>
      </div>

      <div class="controls" role="region" aria-label="Interactive controls">
        <button id="melodyBtn" class="small" title="Play a short loving melody">Play a Loving Melody</button>
        <button id="roseBtn" class="small" title="Send a floating rose animation">Send a Floating Rose</button>
        <button id="themeBtn" class="small muted" title="Toggle background theme">Toggle Theme</button>
      </div>

      <div style="margin-top:auto;font-size:12px;color:rgba(255,255,255,0.6)">
        Tip: Tap "Tap to Surprise!" to begin. Use Melody and Rose to add flair.
      </div>
    </div>

    <div class="right" aria-hidden="false">
      <div class="banner">
        <div>
          <div class="title-big typewriter" id="greetingLine" aria-live="polite">Wishing you endless love and joy...</div>
          <div style="font-size:13px;color:rgba(255,255,255,0.7)">Interactive, caring, and made with love.</div>
        </div>
      </div>

      <div class="msg-list" id="msgList" tabindex="0" aria-label="Message">
        <div class="msg" id="finalWish">
          <div class="meta">A heartfelt wish</div>
          <div id="wishText">
            <!-- final wish will appear here after opening -->
            We celebrate your love, patience and the beautiful life you built together.
            Thank you for showing us what true partnership means. May your days be filled
            with laughter, warmth and countless more memories. Happy anniversary ‚Äî with all my love.
          </div>
        </div>
      </div>
    </div>

    <div class="overlay" id="overlay" role="dialog" aria-modal="true" aria-label="Open greeting">
      <div class="open-card">
        <h2>Celebrate Love</h2>
        <p>Tap to send a shower of confetti and reveal a special interactive card for Mumma & Papa.</p>
        <button id="openBtn" class="big-btn" aria-haspopup="true" aria-controls="stage">Tap to Surprise!</button>
        <div class="small-note">Accessible: press Enter/Space when focused.</div>
      </div>
    </div>

    <div class="rose-canvas" id="roseLayer" aria-hidden="true"></div>
  </div>

  <script>
  (function(){
    const overlay = document.getElementById('overlay');
    const openBtn = document.getElementById('openBtn');
    const confettiCanvas = document.getElementById('confetti');
    const melodyBtn = document.getElementById('melodyBtn');
    const roseBtn = document.getElementById('roseBtn');
    const themeBtn = document.getElementById('themeBtn');
    const msgList = document.getElementById('msgList');
    const wishText = document.getElementById('wishText');
    const roseLayer = document.getElementById('roseLayer');
    const greetingLine = document.getElementById('greetingLine');

    let confettiCtx = null, confettiAnim = null;
    let confettiPieces = [];
    let audioCtx = null;
    let themeToggled = false;

    function fitCanvas(){
      const w = Math.max(1, confettiCanvas.clientWidth || 1);
      const h = Math.max(1, confettiCanvas.clientHeight || 1);
      const dpr = Math.max(1, window.devicePixelRatio || 1);
      confettiCanvas.width = Math.floor(w * dpr);
      confettiCanvas.height = Math.floor(h * dpr);
      confettiCanvas.style.width = w + 'px';
      confettiCanvas.style.height = h + 'px';
      confettiCtx = confettiCanvas.getContext('2d');
      confettiCtx.setTransform(dpr,0,0,dpr,0,0);
      confettiCtx.clearRect(0,0,w,h);
    }
    window.addEventListener('resize', fitCanvas, {passive:true});
    fitCanvas();

    function launchConfetti(duration=2200, count=80){
      cancelConfetti();
      confettiPieces = [];
      const w = confettiCanvas.clientWidth, h = confettiCanvas.clientHeight;
      for(let i=0;i<count;i++){
        confettiPieces.push({
          x: Math.random()*w, y: -10,
          vx: (Math.random()-0.5)*2.6, vy: 1 + Math.random()*3.2,
          rot: Math.random()*Math.PI*2, vr: (Math.random()-0.5)*0.3,
          size: 6 + Math.random()*10,
          color: ['#ff8fab','#ffd166','#9be7ff','#a0ffa0','#ffd1ff'][Math.floor(Math.random()*5)]
        });
      }
      const start = performance.now();
      function frame(t){
        const elapsed = t - start;
        confettiCtx.clearRect(0,0,w,h);
        for(const p of confettiPieces){
          p.x += p.vx; p.y += p.vy; p.rot += p.vr; p.vy += 0.03;
          confettiCtx.save();
          confettiCtx.translate(p.x,p.y);
          confettiCtx.rotate(p.rot);
          confettiCtx.fillStyle = p.color;
          confettiCtx.fillRect(-p.size/2,-p.size/2,p.size, p.size*0.6);
          confettiCtx.restore();
        }
        if (elapsed < duration) confettiAnim = requestAnimationFrame(frame);
        else cancelConfetti();
      }
      confettiAnim = requestAnimationFrame(frame);
    }
    function cancelConfetti(){
      if(confettiAnim){ cancelAnimationFrame(confettiAnim); confettiAnim = null; }
      if(confettiCtx) confettiCtx.clearRect(0,0,confettiCanvas.clientWidth,confettiCanvas.clientHeight);
    }

    function openGreeting(){
      if (openBtn.disabled) return;
      openBtn.disabled = true;
      overlay.style.transition = 'opacity 420ms ease';
      overlay.style.opacity = '0';
      setTimeout(()=> overlay.style.display = 'none', 420);
      launchConfetti(2400,100);
      // typewriter + reveal final complete wish
      typewriter([
        "To my dearest Mumma and Papa,",
        "Thank you for the endless love and guidance.",
        "May your hearts stay as warm and your smiles as bright as ever.",
        "Happy Anniversary. I love you both, always."
      ], () => {
        // after typewriter, set the full wish text plainly (complete wish)
        wishText.textContent = "Dear Mumma and Papa,\nThank you for the endless love ‚Äî On this special day we celebrate the love that built our family. Your patience, laughter and endless support inspire us every day. May your years ahead be filled with joy, health and many more beautiful memories together. Happy Anniversary with all my love.";
      });
    }
    openBtn.addEventListener('click', openGreeting);
    openBtn.addEventListener('keydown', (e)=>{ if(e.key==='Enter' || e.key===' ') { e.preventDefault(); openGreeting(); }});

    function typewriter(lines, delay=100, done){
      greetingLine.textContent = '';
      let idxLine = 0, idxChar = 0;
      const step = ()=>{
        if (idxLine >= lines.length) { if (typeof done === 'function') done(); return; }
        const line = lines[idxLine];
        if (idxChar <= line.length){
          greetingLine.textContent = line.slice(0, idxChar);
          idxChar++;
          setTimeout(step, delay);
        } else {
          idxLine++; idxChar = 0;
          setTimeout(step, 700);
        }
      };
      step();
    }

    function playMelody(){
      try {
        if (!audioCtx) audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        const ctx = audioCtx;
        if (ctx.state === 'suspended') ctx.resume();
        const master = ctx.createGain(); master.gain.value = 0.24; master.connect(ctx.destination); // increased volume
        const now = ctx.currentTime;
        const notes = [523.25, 659.25, 783.99, 1046.5];
        notes.forEach((freq,i)=>{
          const o = ctx.createOscillator(); o.type = 'sine';
          const g = ctx.createGain(); g.gain.value = 0;
          o.frequency.value = freq;
          o.connect(g); g.connect(master);
          const t = now + i*0.26;
          g.gain.linearRampToValueAtTime(0.2, t+0.02);
          g.gain.exponentialRampToValueAtTime(0.0001, t+0.8);
          o.start(t); o.stop(t+1.0);
        });
        // graceful fade out
        setTimeout(()=>{ master.gain.exponentialRampToValueAtTime(0.0001, ctx.currentTime+0.8); }, 1400);
      } catch(e){
        console.warn('Audio unavailable', e);
      }
    }
    melodyBtn.addEventListener('click', ()=> playMelody());
    melodyBtn.addEventListener('keydown', (e)=>{ if(e.key==='Enter' || e.key===' ') { e.preventDefault(); playMelody(); }});

    function sendRose(){
      const span = document.createElement('div');
      span.textContent = 'üåπ';
      span.style.position = 'absolute';
      span.style.left = (10 + Math.random()*80) + '%';
      span.style.bottom = '-40px';
      span.style.fontSize = (28 + Math.random()*20) + 'px';
      span.style.opacity = '0.95';
      span.style.transform = 'translateY(0) scale(1)';
      span.style.transition = 'transform 3.6s cubic-bezier(.18,.9,.3,1), opacity 3.6s linear';
      roseLayer.appendChild(span);
      requestAnimationFrame(()=> {
        span.style.transform = 'translateY(-420px) scale(1.08)';
        span.style.opacity = '0';
      });
      setTimeout(()=> { span.remove(); }, 3800);
    }
    roseBtn.addEventListener('click', sendRose);
    roseBtn.addEventListener('keydown', (e)=>{ if(e.key==='Enter' || e.key===' ') { e.preventDefault(); sendRose(); }});

    themeBtn.addEventListener('click', ()=>{
      themeToggled = !themeToggled;
      if (themeToggled){
        document.documentElement.style.setProperty('--bg-0', '#031018');
        document.documentElement.style.setProperty('--bg-1', '#0b3b58');
      } else {
        document.documentElement.style.setProperty('--bg-0', '#071026');
        document.documentElement.style.setProperty('--bg-1', '#3a0ca3');
      }
    });

    window.addEventListener('beforeunload', () => {
      cancelConfetti();
      if (audioCtx && audioCtx.close) { try{ audioCtx.close(); } catch(e){} }
    });

    overlay.addEventListener('keydown', (e)=> { if(e.key==='Escape') { overlay.style.display='none'; } });
    openBtn.focus();
    overlay.addEventListener('pointerdown', (e) => { if (e.target === overlay) openBtn.click(); });
    setTimeout(()=> fitCanvas(), 120);
  })();
  </script>
</body>
</html>
